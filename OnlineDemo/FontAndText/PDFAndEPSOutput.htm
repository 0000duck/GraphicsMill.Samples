<!DOCTYPE html>
<html lang="en">
<head>
	<title>Watermark</title>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
	<script src="//code.jquery.com/jquery-2.1.1.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		$(function () {
			var canvas = $("#canvas1");

			var image = null;

			function render() {
				var ctx = canvas[0].getContext("2d");

				//Clear
				ctx.clearRect(0, 0, canvas.width(), canvas.height());

				//Image
				if (image != null) {
					ctx.drawImage(image, 0, 0);
				}
			}

			function loadData() {
				$.ajax({
					url: "../api/FontAndText/GetPDFAndEPSOutput",
					type: "POST",
					data: {
						FrontText: $("#inputFrontText").val(),
						BackText: $("#inputBackText").val()
					},
					success: function (data) {
						$("#downloadPdf").attr("href", "../DownloadFile.ashx?id=" + data.PdfFileId).show();
						$("#downloadEps").attr("href", "../DownloadFile.ashx?id=" + data.EpsFileId).show();

						image = new Image();
						image.src = "data:image/png;base64," + data.Preview;
						image.onload = function () {
							render();
						}
					}
				});
			}

			$("input").bind("change keyup", function () {
				loadData();
			});

			function init() {
				loadData();
				render();
			}

			init();
		});
	</script>
</head>
<body>
	<div role="form">
		<div class="form-group">
			<label for="inputFrontText">Front side text</label>
			<input id="inputFrontText" type="text" value="Front side" class="form-control" />
		</div>
		<div class="form-group">
			<label for="inputBackText">Back side text</label>
			<input id="inputBackText" type="text" value="Back side" class="form-control" />
		</div>
		<div class="form-group">
			<a id="downloadPdf" class="btn btn-primary" style="display:none;"><span class="glyphicon glyphicon-save"></span> Download PDF (both sides)</a>
			<a id="downloadEps" class="btn btn-default" style="display:none;"><span class="glyphicon glyphicon-save"></span> Download EPS (front side only)</a>
		</div>
	</div>
	<canvas id="canvas1" width="600" height="180" style="border: 1px solid #f0f0f0;"></canvas>
</body>
</html>
